pipeline {

    agent any


    stages {

        stage("build") {
            steps {
                agent {
                    dockerfile {
                        filename 'Dockerfile'
                        additionalBuildArgs '-t my_image'
                    }
                }
            }
        }

        stage("test") {
            steps {
                sh 'docker image ls'
            }
        }

    }

}